
/**
 * @description 网络请求
 * @param {Object} option
 * @returns {Promise}
 * @example
 * request({
 *  url: '',
 *  method: 'GET',
 *  header: {'ABTEST-SIGN': 'xxxxx'}, // 选填
 *  data: {} // 选填
 * })
 */
const request = (option) => {
  if(String(option) !== '[object Object]') return undefined;
  option.method = option.method ? option.method.toUpperCase() : 'GET';
  option.data = option.data || {};
  let formData = [];
  for(var key in option.data) {
    formData.push(''.concat(key, '=', option.data[key]));
  }
  option.data = formData.join('&');

  if(option.method === 'GET') {
    option.url += ''.concat('?', option.data);
  }
  const xhr = new XMLHttpRequest();
  xhr.responseType = option.responseType || 'json';
  xhr.timeout = 2000; // 超时时间，单位是毫秒
  xhr.onreadystatechange = function() {
    if(xhr.readyState === 4) {
      if(xhr.status === 200 && option.success) {
        option.success(xhr.response);
      }
      else if(option.error) {
        option.error();
      }
    }
  };
  xhr.open(option.method, option.url, true);
  if(option.method === 'POST') {
    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
  }
  if(option.header) {
    for(const key in option.header) {
      xhr.setRequestHeader(key, option.header[key]);
    }
  }
  xhr.send(option.method === 'POST' ? option.data : null);
};

export default request;
